<h1>{{tituloPagina}}</h1>

<ul class="lista-productos">
  {{#each productos}}
    <li class="producto-card" data-id="{{_id}}">
      <h2 class="producto-titulo">{{titulo}}</h2>
      <p class="producto-descripcion">{{descripcion}}</p>

      <p class="producto-detalle">
        <span class="precio">ðŸ’° $ {{precio}}</span>
        <span class="categoria">ðŸ¥« {{categoria}}</span>
        <span class="stock">ðŸ“¦ Stock: {{stock}}</span>
      </p>

      <button class="boton-agregar">Agregar al carrito</button>
    </li>
  {{/each}}
</ul>

<div class="paginacion">
  <p>PÃ¡gina {{page}} de {{totalPages}}</p>

  <div class="paginacion-links">
    {{#if hasPrevPage}}
      <a href="{{prevLink}}">â¬… Anterior</a>
    {{/if}}

    {{#if hasNextPage}}
      <a href="{{nextLink}}">Siguiente âž¡</a>
    {{/if}}
  </div>
</div>

<script>
  // ðŸ‘‰ ID del carrito del usuario logueado
  const idCarrito = "{{#if usuario}}{{usuario.carritoId}}{{/if}}";

  const botones = document.querySelectorAll(".boton-agregar");

  botones.forEach(function (boton) {
    boton.addEventListener("click", function () {
      if (!idCarrito) {
        alert("TenÃ©s que iniciar sesiÃ³n para agregar al carrito");
        return;
      }

      const li = boton.closest("li");
      const idProducto = li.dataset.id;

      fetch(`/api/carts/${idCarrito}/products/${idProducto}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" }
      })
        .then(function (res) {
          return res.json();
        })
        .then(function (data) {
          if (data && data.error) {
            alert(data.error);
            return;
          }
          alert("Producto agregado al carrito");
        })
        .catch(function (error) {
          console.log("Error al agregar al carrito:", error);
          alert("No se pudo agregar el producto al carrito");
        });
    });
  });
</script>

