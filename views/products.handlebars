<h1>{{tituloPagina}}</h1>

<ul>
  {{#each productos}}
    <li data-id="{{_id}}">
      <strong>{{titulo}}</strong><br>
      {{descripcion}}<br>
      Precio: $ {{precio}}<br>
      Categor√≠a: {{categoria}}<br>
      Stock: {{stock}}<br>
      <button class="boton-agregar">Agregar al carrito</button>
    </li>
    <hr>
  {{/each}}
</ul>

<div>
  <p>P√°gina {{page}} de {{totalPages}}</p>

  {{#if hasPrevPage}}
    <a href="{{prevLink}}">‚¨Ö Anterior</a>
  {{/if}}

  {{#if hasNextPage}}
    <a href="{{nextLink}}">Siguiente ‚û°</a>
  {{/if}}
</div>

<script>
  // üëâ PON√â AC√Å EL ID DE UN CARRITO REAL
  const idCarrito = "692ef67f7023abf125bb1b08";

  const botones = document.querySelectorAll(".boton-agregar");

  botones.forEach(function (boton) {
    boton.addEventListener("click", function () {
      const li = boton.closest("li");
      const idProducto = li.dataset.id;

      fetch(`/api/carts/${idCarrito}/products/${idProducto}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" }
      })
        .then(function (res) {
          return res.json();
        })
        .then(function (data) {
          alert("Producto agregado al carrito");
        })
        .catch(function (error) {
          console.log("Error al agregar al carrito:", error);
          alert("No se pudo agregar el producto al carrito");
        });
    });
  });
</script>
