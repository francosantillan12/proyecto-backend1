ğŸ›’ Proyecto Backend II â€“ Ecommerce (ContinuaciÃ³n Backend I)

Este proyecto es la continuaciÃ³n del trabajo desarrollado en Backend I, donde se construyÃ³ la base del ecommerce con:

CRUD de productos

CRUD de carritos

MongoDB + Mongoose

PaginaciÃ³n

Arquitectura con routers y controllers

En esta etapa (Backend II) se mejora la arquitectura, seguridad y lÃ³gica de negocio, incorporando mecanismos de autenticaciÃ³n y autorizaciÃ³n.

ğŸš€ TecnologÃ­as utilizadas

Node.js

Express

MongoDB Atlas

Mongoose

Passport

JWT (JSON Web Tokens)

Bcrypt

Nodemailer

Arquitectura en capas (Router â†’ Controller â†’ Repository â†’ DAO)

ğŸ” Sistema de AutenticaciÃ³n

Se implementa:

Registro de usuarios con contraseÃ±a encriptada (bcrypt)

Login con JWT almacenado en cookie httpOnly

Estrategia current con Passport

Endpoint /api/sessions/current utilizando DTO para evitar enviar informaciÃ³n sensible

DTO implementado

Se utiliza UserDTO para evitar enviar:

password

resetToken

resetTokenExp

ğŸ”„ RecuperaciÃ³n de contraseÃ±a

Se implementa:

GeneraciÃ³n de token seguro

EnvÃ­o de email con enlace de recuperaciÃ³n

Token con expiraciÃ³n de 1 hora

ValidaciÃ³n para evitar reutilizar la misma contraseÃ±a anterior

Endpoints:

POST /api/sessions/forgot-password
POST /api/sessions/reset-password/:token
ğŸ‘¥ Roles y AutorizaciÃ³n

Se implementa middleware de autorizaciÃ³n basado en roles.

Reglas:

ğŸ”“ GET productos â†’ pÃºblico

ğŸ”’ Crear / actualizar / eliminar productos â†’ solo ADMIN

ğŸ”’ Agregar productos al carrito â†’ solo USER

ğŸ”’ Comprar carrito â†’ solo USER y solo su propio carrito

Middleware utilizado:

passport.authenticate("current")

authorizeRoles(["admin"])

authorizeRoles(["user"])

ğŸ§± Arquitectura Profesional

El proyecto aplica separaciÃ³n en capas:

Router â†’ define endpoints

Controller â†’ lÃ³gica de negocio

Repository â†’ intermediario

DAO â†’ acceso directo a base de datos

DTO â†’ transferencia segura de datos

Esto permite:

Escalabilidad

CÃ³digo mÃ¡s mantenible

SeparaciÃ³n clara de responsabilidades

ğŸŸ Sistema de Compra y Ticket

Se implementa modelo Ticket con:

code Ãºnico

purchase_datetime

amount total

purchaser (email del usuario)

Endpoint:

POST /api/carts/:cid/purchase

LÃ³gica implementada:

VerificaciÃ³n de stock

Compra completa o parcial

Descuento de stock

GeneraciÃ³n de ticket

Productos sin stock permanecen en el carrito

âš™ï¸ Variables de entorno

El proyecto utiliza archivo .env (no incluido en el repositorio).

Se provee .env.example como referencia.

Variables necesarias:

PORT
MONGO_URL
JWT_SECRET
MAIL_USER
MAIL_PASS
ğŸ§ª CÃ³mo probar el proyecto

Clonar repositorio

Instalar dependencias:

npm install

Crear archivo .env usando .env.example

Ejecutar:

npm run dev

Servidor disponible en:

http://localhost:8080
ğŸ“Œ Estado del proyecto

âœ” CRUD completo
âœ” AutenticaciÃ³n con JWT
âœ” AutorizaciÃ³n por roles
âœ” PatrÃ³n Repository implementado
âœ” DTO para protecciÃ³n de datos
âœ” RecuperaciÃ³n de contraseÃ±a con expiraciÃ³n
âœ” Modelo Ticket y lÃ³gica de compra robusta
âœ” Manejo de compras parciales

